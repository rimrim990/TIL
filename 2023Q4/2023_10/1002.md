# TIL - 2023.10.02(ì›”)
## JVM í´ë˜ìŠ¤ ë¡œë”

ë²Œì¨ 10ì›”ì´ë¼ë‹ˆ ğŸ˜°

### ì„œë¬¸
JVM ì´ ì–´ë–¤ ê³¼ì •ìœ¼ë¡œ í´ë˜ìŠ¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ì§€ ì•Œì•„ë³´ì

### í´ë˜ìŠ¤ ë¡œë”©
ìë°” ì»´íŒŒì¼ëŸ¬ì— ì˜í•´ ì»´íŒŒì¼ëœ ìë°” í´ë˜ìŠ¤ íŒŒì¼ (`.class`) ì€ í´ë˜ìŠ¤ ë¡œë” (Class Loader) ì— ì˜í•´ ë©”ëª¨ë¦¬ì— íƒ‘ì¬ëœë‹¤.
- í´ë˜ìŠ¤ ë¡œë”ëŠ” í´ë˜ìŠ¤ ë¡œë”©ì„ ìˆ˜í–‰í•˜ëŠ” ê°ì²´ì´ë‹¤

í´ë˜ìŠ¤ ë¡œë”ëŠ” ë°”ì´íŠ¸ í´ë˜ìŠ¤ íŒŒì¼ì„ ë©”ëª¨ë¦¬ì— ë¡œë”©í•˜ëŠ” ê²ƒ ì™¸ì—ë„ ë§í‚¹ (Linking) ê³¼ ì´ˆê¸°í™”ë¥¼ ìˆ˜í–‰í•œë‹¤.
- ë§í‚¹ì€ í´ë˜ìŠ¤ íŒŒì¼ì„ ì‚¬ìš©í•˜ê¸° ì „ì— ê²€ì¦í•˜ëŠ” í–‰ìœ„ì´ë‹¤
- ì´ˆê¸°í™”ëŠ” ì •ì  ë³€ìˆ˜ë¥¼ ì •ì˜ëœ ê°’ë“¤ë¡œ ì´ˆê¸°í™”í•˜ëŠ” í–‰ìœ„ì´ë‹¤

**ë¡œë”©**

<img width="400" src="https://tecoble.techcourse.co.kr/static/8620cd5d0bd1f37f2e603a5a5d763b39/2f3a8/2021-07-26-classloader-process.png">

- `ClassLoader` í´ë˜ìŠ¤ëŠ” ê³„ì¸µ êµ¬ì¡°ë¡œ ì´ë£¨ì–´ì ¸ìˆìœ¼ë©° í´ë˜ìŠ¤ íƒìƒ‰ì„ ìœ„í•´ ë¶€ëª¨ `ClassLoader`ì— ìš”ì²­ì„ ìœ„ì„í•œë‹¤
- ìƒìœ„ í´ë˜ìŠ¤ ë¡œë”ì—ì„œ í´ë˜ìŠ¤ íŒŒì¼ì„ ì°¾ì§€ ëª»í•˜ë©´ í•˜ìœ„ ë¡œë”ê°€ í´ë˜ìŠ¤ íŒŒì¼ì„ ì°¾ëŠ”ë‹¤
- `ClassLoader`ëŠ” í´ë˜ìŠ¤ê°€ ì‹¤ì œë¡œ ì‚¬ìš©ë  ë•Œ ë©”ëª¨ë¦¬ì— ë¡œë”©í•œë‹¤

**ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¡œë”**
- ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¡œë”ëŠ” ëª¨ë“  í´ë˜ìŠ¤ ë¡œë”ì˜ ë¶€ëª¨ê°€ ë˜ëŠ” ê°€ì¥ ìƒìœ„ ê³„ì¸µ ë¡œë”ì´ë‹¤
- `java.util`ì´ë‚˜ `java.lang`ê³¼ ê°™ì€ JVM êµ¬ë™ì— í•„ìˆ˜ì ì¸ í´ë˜ìŠ¤ íŒŒì¼ë“¤ì„ ë¡œë”©í•œë‹¤
- ìë°” ì‹¤í–‰ ì´ˆê¸°ì— ë™ì‘í•œë‹¤
```java
// java -verbose:class OuterClass
[0.014s][info][class,load] java.lang.StringBuffer source: shared objects file
[0.014s][info][class,load] java.lang.StringBuilder source: shared objects file
```
- ë¶€íŠ¸ìŠ¤íŠ¸ë© í´ë˜ìŠ¤ ë¡œë”ê°€ `java.lang` íŒ¨í‚¤ì§€ í´ë˜ìŠ¤ë“¤ì„ ë¡œë”©í–ˆë‹¤

```java
[0.012s][info][class,load] jdk.internal.loader.ClassLoaders$AppClassLoader source: shared objects file
[0.012s][info][class,load] jdk.internal.loader.ClassLoaders$PlatformClassLoader source: shared objects file
```
- í•˜ìœ„ ê³„ì¸µì˜ í´ë˜ìŠ¤ ë¡œë”ë“¤ë„ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¡œë”ì— ì˜í•´ ë¡œë”©ëœë‹¤

**ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”**
- ì‹œìŠ¤í…œ í´ë˜ìŠ¤ ë¡œë”ë¼ê³ ë„ ë¶ˆë¦¬ë©° í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— ìˆëŠ” í´ë˜ìŠ¤ë“¤ì„ ë©”ëª¨ë¦¬ì— íƒ‘ì¬í•œë‹¤
- ê°œë°œìë“¤ì´ ì‘ì„±í•œ í´ë˜ìŠ¤ë¥¼ ë¡œë”©í•œë‹¤
```java
// java -verbose:class OuterClass
[0.301s][info][class,load] learn.java.testrepository.plain.loader.OuterClass source: file:/OuterClass.java
```
- í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— ì§ì ‘ ì‘ì„±í•œ `Outer.class`ë¥¼ ë¡œë”©í–ˆë‹¤

```java
ì˜¤ë¥˜: ê¸°ë³¸ í´ë˜ìŠ¤ .OuterClass.javaì„(ë¥¼) ì°¾ê±°ë‚˜ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ì›ì¸: java.lang.ClassNotFoundException: /out/java
```
- ë§Œì•½ í´ë˜ìŠ¤ë¥¼ ì°¾ì§€ ëª»í•˜ë©´ `ClassNotFoundException`ì„ ë˜ì§„ë‹¤

**í´ë˜ìŠ¤ íŒŒì¼**
```java
// OuterClass.class.getClassLoader();
jdk.internal.loader.ClassLoaders$AppClassLoader@531d72ca
```
- í´ë˜ìŠ¤ ë¡œë”ëŠ” `.class` íŒŒì¼ë¡œë¶€í„° `Class` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤
- ëª¨ë“  `Class` ê°ì²´ëŠ” ìì‹ ì„ ìƒì„±í•œ í´ë˜ìŠ¤ ë¡œë”ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ê°–ê³ ìˆë‹¤

### ë§í‚¹ (Linking)
ë§í‚¹ì€ ë¡œë”©ëœ í´ë˜ìŠ¤ íŒŒì¼ë“¤ì„ ê²€ì¦í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì¤€ë¹„í•˜ëŠ” ê³¼ì •ì´ë‹¤
- í´ë˜ìŠ¤ íŒŒì¼ì´ ìœ íš¨í•œì§€ í™•ì¸í•œë‹¤
- í´ë˜ìŠ¤ ë° ì¸í„°í˜ì´ìŠ¤ì—ì„œ í•„ìš”í•œ ì •ì  í•„ë“œë“¤ì„ ë©”ëª¨ë¦¬ì— í• ë‹¹í•˜ê³  ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•œë‹¤
  - ex) `int` ëŠ” 0ìœ¼ë¡œ, ê°ì²´ ì°¸ì¡°ëŠ” `null`ì„ í• ë‹¹í•œë‹¤

### ì´ˆê¸°í™” (Initialization)
ì´ˆê¸°í™”ëŠ” í´ë˜ìŠ¤ì˜ ì •ì  í•„ë“œ ê°’ë“¤ì„ ì´ˆê¸°í™”í•˜ê³  ì •ì  ì´ˆê¸°í™” ë¸”ë¡ì„ ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì´ë‹¤

**ì´ˆê¸°í™”ê°€ ì¼ì–´ë‚˜ëŠ” ì¡°ê±´**
- í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í–ˆì„ ë•Œ
- í´ë˜ìŠ¤ì— ì •ì˜ëœ ì •ì  ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì„ ë•Œ
- í´ë˜ìŠ¤ì— ì •ì˜ëœ ì •ì  í•„ë“œì— ê°’ì„ í• ë‹¹í•  ë•Œ
- í´ë˜ìŠ¤ì— ì •ì˜ëœ `final`ì´ ì•„ë‹Œ ì •ì  í•„ë“œì— ì ‘ê·¼í–ˆì„ ë•Œ

í´ë˜ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ë©´ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ëª¨ë“  ë¶€ëª¨ í´ë˜ìŠ¤ë“¤ë„ í•¨ê»˜ ì´ˆê¸°í™”ë˜ì–´ì•¼ í•œë‹¤

**ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸**
```java
public class MainClass {

  static {
    System.out.println("MainClass.ì •ì  ì´ë‹ˆì…œë¼ì´ì €");
  }

  public static void main(String[] args) {
    System.out.println("MainClass.main");
  }
}

[0.334s][info][class,load] learn.java.testrepository.plain.loader.MainClass source: file:/MainClass.java
MainClass.ì •ì  ì´ë‹ˆì…œë¼ì´ì €
MainClass.main
```
- `main` ë©”ì„œë“œê°€ ì •ì˜ëœ `MainClass`ë¥¼ ì‹¤í–‰í•˜ë©´ í´ë˜ìŠ¤ ë¡œë”ì— ì˜í•´ `MainClass`ê°€ ë¡œë”©ëœë‹¤
- ì´í›„ `static`ë©”ì„œë“œ ì‹¤í–‰ìœ¼ë¡œ ì¸í•´ `MainClass` ê°€ ì´ˆê¸°í™”ë˜ê³  ì •ì  ì´ˆê¸°í™” ë¸”ë¡ì´ ì‹¤í–‰ëœë‹¤
- `MainClass`ì˜ ë©”ì¸ í•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤

```java
public class OuterClass {

    static final String TEST01 = "I'm TEST01";

    static
    {
        System.out.println("OuterClass.ì •ì  ì´ë‹ˆì…œë¼ì´ì €, TEST01 = " + TEST01);
    }

    static class Inner
    {

        static
        {
            System.out.println("OuterClass.Inner.ì •ì  ì´ë‹ˆì…œë¼ì´ì €");
        }

        public static String info()
        {
            return "I'm a method in Inner";
        }
    }
}
```
- ìœ„ì™€ ê°™ì´ ì¤‘ì²© í´ë˜ìŠ¤ì¸ `Inner`í´ë˜ìŠ¤ê°€ ì •ì˜ëœ `Outer`í´ë˜ìŠ¤ì˜ í´ë˜ìŠ¤ ë¡œë”©ê³¼ ì´ˆê¸°í™” ì‹œì ì„ ì•Œì•„ë³´ì

```java
// OuterClass.java
public static void main(String[] args) {
        System.out.println("OuterClass.main");
        System.out.println(Inner.class);
}

OuterClass.main
[0.317s][info][class,load] learn.java.testrepository.plain.loader.OuterClass$Inner source: file:/OuterClass.java
class learn.java.testrepository.plain.loader.OuterClass$Inner
```
- `OuterClass`ì— ë©”ì¸ ë©”ì†Œë“œë¥¼ ì¶”ê°€í•˜ê³  `InnerClass`ì˜ í´ë˜ìŠ¤ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ë„ë¡ í•˜ì˜€ë‹¤
- `OuterClass`ê°€ ë¡œë”©ë˜ë”ë¼ë„ ì¤‘ì²© í´ë˜ìŠ¤ëŠ” ì•„ì§ í´ë˜ìŠ¤ ë¡œë”ì— ì˜í•´ ë¡œë”©ë˜ì§€ ì•Šì•˜ë‹¤
- `Inner` í´ë˜ìŠ¤ê°€ ì‹¤ì œë¡œ ì‚¬ìš©ë˜ëŠ” ì‹œì ì— í´ë˜ìŠ¤ ë¡œë”ì— ì˜í•´ ë¡œë”©ë˜ì—ˆë‹¤
  - í´ë˜ìŠ¤ëŠ” ë¡œë”©ë˜ì—ˆì§€ë§Œ ì•„ì§ ì´ˆê¸°í™” ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•Šì•„ ì´ˆê¸°í™”ë˜ì§€ëŠ” ì•ŠìŒ (ì •ì  ì´ˆê¸°í™” ë¸”ë¡ ì‹¤í–‰ X)

```java
// OuterClass.java
public static void main(String[] args) {
        System.out.println("OuterClass.main");
        System.out.println(Inner.info());
}

OuterClass.main
// í´ë˜ìŠ¤ ë¡œë”
[0.280s][info][class,load] learn.java.testrepository.plain.loader.OuterClass$Inner source: file:/OuterClass.java 
// ì •ì  ì´ˆê¸°í™”
OuterClass.Inner.ì •ì  ì´ë‹ˆì…œë¼ì´ì € 
I'm a method in Inner
```
- `Inner` í´ë˜ìŠ¤ì˜ ì •ì  ë©”ì„œë“œë¥¼ í˜¸ì¶œë„ë¡ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì˜€ë‹¤
- `Inner` í´ë˜ìŠ¤ê°€ ë¡œë”©ëœ í›„ ì´ˆê¸°í™” ê³¼ì •ì´ ì‹¤í–‰ë˜ì–´ ì •ì  ì´ˆê¸°í™” ë¸”ë¡ì´ ì‹¤í–‰ë˜ì—ˆë‹¤

```java
static class Parent {
    static {
            System.out.println("OuterClass.Parent.ì •ì  ì´ë‹ˆì…œë¼ì´ì €");
    }
}

static class Inner extends Parent {
    public static String TEST02 = "I'm TEST02";

    static
    {
        System.out.println("OuterClass.Inner.ì •ì  ì´ë‹ˆì…œë¼ì´ì €");
    }
        
    public static String info() 
    {
        return "I'm a method in Inner";
    }
}
```
- í´ë˜ìŠ¤ê°€ ë¡œë”© ì‹œì— ë¶€ëª¨ í´ë˜ìŠ¤ë„ ê°™ì´ ë¡œë”©ë˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì‹¶ì–´ `Inner` í´ë˜ìŠ¤ê°€ `Parent` í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ë„ë¡ ìˆ˜ì •í•˜ì˜€ë‹¤

```java
public static void main(String[] args) {
    System.out.println("OuterClass.main");
    System.out.println(Inner.info());
}

// í´ë˜ìŠ¤ ë¡œë”
[0.267s][info][class,load] learn.java.testrepository.plain.loader.OuterClass$Parent source: file:/OuterClass.java
[0.267s][info][class,load] learn.java.testrepository.plain.loader.OuterClass$Inner source: file:/OuterClass.java 
// ì •ì  ì´ˆê¸°í™”
OuterClass.Parent.ì •ì  ì´ë‹ˆì…œë¼ì´ì € 
OuterClass.Inner.ì •ì  ì´ë‹ˆì…œë¼ì´ì € 
I'm a method in Inner
```
- ë¶€ëª¨ í´ë˜ìŠ¤ì¸ `Parent`ê°€ ë¨¼ì € ë¡œë”©ë˜ê³  ì´í›„ ìì‹ í´ë˜ìŠ¤ì¸ `Inner` í´ë˜ìŠ¤ê°€ ë¡œë”©ë˜ì—ˆë‹¤
- í´ë˜ìŠ¤ ë¡œë”©ì´ ëë‚œí›„ ì´í›„ ë‹¨ê³„ì¸ ì´ˆê¸°í™”ê°€ `Parent`, `Inner` ìˆœì„œëŒ€ë¡œ ìˆ˜í–‰ë˜ì—ˆë‹¤

```java
public static void main(String[] args) {
        System.out.println("OuterClass.main");
        // final í•„ë“œ ê°’ ì ‘ê·¼
        System.out.println(Inner.TEST03);
}

OuterClass.main
I'm TEST03
```
- ë˜í•œ ì •ì  `final` ë³€ìˆ˜ë¥¼ ì°¸ì¡°í–ˆì„ ë•ŒëŠ” í´ë˜ìŠ¤ ë¡œë”©ê³¼ ì´ˆê¸°í™”ê°€ ìˆ˜í–‰ë˜ì§€ ì•Šì•˜ë‹¤
- ì›ì‹œ ê°’ì´ë‚˜ ë¬¸ìì—´ íƒ€ì…ì˜ `static final` ê°’ì€ ì»´íŒŒì¼ íƒ€ì„ì— ê²°ì •ë˜ëŠ” ìƒìˆ˜ ê°’ì´ê¸° ë•Œë¬¸ì— í´ë˜ìŠ¤ë¥¼ ë¡œë”©í•  í•„ìš”ê°€ ì—†ë‹¤ê³  í•œë‹¤

```java
 public static void main(String[] args) {
        System.out.println("OuterClass.main");
        // ê°ì²´ ì°¸ì¡°ê°’
        System.out.println(Inner.obj);
}

// í´ë˜ìŠ¤ ë¡œë”ì— ì˜í•´ ë¡œë”©
[0.308s][info][class,load] learn.java.testrepository.plain.loader.OuterClass$Parent source: file:/OuterClass.java
[0.308s][info][class,load] learn.java.testrepository.plain.loader.OuterClass$Inner source: file:/OuterClass.java
// ì •ì  ì´ˆê¸°í™”
OuterClass.Parent.ì •ì  ì´ë‹ˆì…œë¼ì´ì € 
OuterClass.Inner.ì •ì  ì´ë‹ˆì…œë¼ì´ì €
// ì°¸ì¡°ê°’
java.lang.Object@44a3ec6b
```
- ê·¸ëŸ¬ë‚˜ `final`ìœ¼ë¡œ ì„ ì–¸ëœ í•„ë“œë¼ í•˜ë”ë¼ë„ ê°ì²´ ì°¸ì¡°ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— ë‚´ë¶€ ê°’ì´ ë³€í•  ìˆ˜ ìˆë‹¤
- ë”°ë¼ì„œ ê°ì²´ ì°¸ì¡° ê°’ì— ì ‘ê·¼í•  ê²½ìš° í´ë˜ìŠ¤ ë¡œë”ì— ì˜í•´ ë¡œë”©ëœë‹¤ê³  í•œë‹¤

```java
public static void main(String[] args) {
        System.out.println("OuterClass.main");
        // OuterClass.Inner.TEST03
        System.out.println("I'm TEST03");
        System.out.println(OuterClass.Inner.obj);
}
```
- `Inner.class` íŒŒì¼ì„ ë””ì»´íŒŒì¼í•´ë³´ë‹ˆ ì‹¤ì œë¡œ `String` íƒ€ì…ì˜ ìƒìˆ˜ ê°’ì€ ì»´íŒŒì¼ íƒ€ì„ì— ê°’ì´ ê²°ì •ë˜ì–´ ìˆì—ˆë‹¤ (`I'm TEST03`)
- ë°˜ë©´ì— ê°™ì€ ìƒìˆ˜ê°’ì´ì–´ë„ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” `obj` í•„ë“œëŠ” ì»´íŒŒì¼ íƒ€ì„ì— ê°’ì´ ê²°ì •ë˜ì–´ ìˆì§€ ì•Šì•˜ë‹¤

### ì°¸ê³ 
- https://tecoble.techcourse.co.kr/post/2021-07-15-jvm-classloader/-12.html#jls-12.2
- https://stackoverflow.com/questions/24538509/does-the-java-classloader-load-inner-classes#comment37999635_24538703